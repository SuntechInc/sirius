{
  "openapi": "3.0.0",
  "paths": {
    "/auth/login": {
      "post": {
        "operationId": "AuthController_login",
        "parameters": [],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/CredentialDto" }
            }
          }
        },
        "responses": { "200": { "description": "" } },
        "summary": "Login",
        "tags": ["Auth"]
      }
    },
    "/auth/profile": {
      "get": {
        "operationId": "AuthController_getProfile",
        "parameters": [],
        "responses": { "200": { "description": "" } },
        "security": [{ "bearer": [] }],
        "summary": "Perfil do usuário - qualquer usuário autenticado",
        "tags": ["Auth"]
      }
    },
    "/companies/companies/filter": {
      "get": {
        "description": "\nThis endpoint allows advanced filtering of companies using query parameters.\n\nHow to filter:\n- All filters are passed as query parameters.\n- You can combine multiple filters (AND logic) by passing several parameters.\n- For OR logic, prefix the parameter with or. (e.g., or.tradingName).\n- Use operators like eq: (equals), in: (in list), etc.\n\nSupported operators:\n- eq: (equals) Example: status=eq:ACTIVE\n- in: (in list) Example: industry=in:TECHNOLOGY,HEALTHCORE\n\nExamples:\n\nSimple filter (AND):\nGET /companies/filter?status=eq:ACTIVE&segment=eq:HOSPITAL\n\nCombined filter (AND + OR):\nGET /companies/filter?status=eq:ACTIVE&or.tradingName=eq:Quail&or.legalName=eq:Suntech\n    ",
        "operationId": "CompanyAdminController_filterCompanies",
        "parameters": [
          {
            "name": "filter",
            "required": false,
            "in": "query",
            "description": "JSON with dynamic filters",
            "examples": {
              "example1": {
                "summary": "Filter by status and segment",
                "value": "{\"status\":\"ACTIVE\",\"segment\":\"HOSPITAL\"}"
              },
              "example2": {
                "summary": "Filter by industry",
                "value": "{\"industry\":\"TECHNOLOGY\"}"
              },
              "example3": {
                "summary": "Multiple filters",
                "value": "{\"tradingName\":\"Company\",\"status\":\"ACTIVE\",\"segment\":\"HOSPITAL\",\"industry\":\"TECHNOLOGY\"}"
              }
            },
            "schema": { "type": "string" }
          },
          {
            "name": "size",
            "required": false,
            "in": "query",
            "description": "Number of items per page (default: 20, max: 100)",
            "schema": { "example": 20, "type": "number" }
          },
          {
            "name": "page",
            "required": false,
            "in": "query",
            "description": "Page number (default: 1)",
            "schema": { "example": 1, "type": "number" }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful response with filtered companies",
            "content": {
              "application/json": {
                "schema": {
                  "example": {
                    "data": [
                      {
                        "id": "00000000000000000000000000000000",
                        "tradingName": "Empresa XPTO",
                        "legalName": "Empresa XPTO LTDA",
                        "taxId": "00000000000000",
                        "taxCountry": "BR",
                        "email": "financeiro@empresa.com.br",
                        "phone": "0000000000",
                        "industry": "TECHNOLOGY",
                        "segment": "HOSPITAL",
                        "status": "ACTIVE",
                        "isBaseCompany": true,
                        "createdAt": "2025-06-23T23:32:29.601Z",
                        "updatedAt": "2025-06-23T23:32:29.601Z"
                      }
                    ],
                    "pagination": {
                      "page": 1,
                      "size": 20,
                      "total": 1,
                      "totalPages": 1,
                      "hasNext": false,
                      "hasPrevious": false
                    }
                  }
                }
              }
            }
          }
        },
        "summary": "Filter companies with dynamic filters",
        "tags": ["Company"]
      }
    },
    "/companies/company": {
      "post": {
        "description": "\nCreates a new company with automatic data transformation and validation.\n\n**Data Transformations:**\n- Trading name and legal name: automatic trim\n- Tax ID: removes non-numeric characters\n- Email: converts to lowercase and trims\n- Phone: automatic trim\n- Tax country: converts to uppercase (default: BR)\n\n**Validation Rules:**\n- Trading name: minimum 3 characters\n- Legal name: minimum 3 characters, required\n- Tax ID: minimum 11 characters, removes non-digits\n- Email: valid email format, required\n- Phone: minimum 10 characters, optional\n- Industry: must be valid enum value\n- Segment: must be valid enum value\n- Status: defaults to ACTIVE\n- isBaseCompany: defaults to false\n    ",
        "operationId": "CompanyAdminController_createCompany",
        "parameters": [],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CreateCompanyGatewayDto"
              },
              "examples": {
                "example1": {
                  "summary": "Basic company creation",
                  "value": {
                    "tradingName": "Empresa XPTO",
                    "legalName": "Empresa XPTO LTDA",
                    "taxId": "12345678000199",
                    "email": "contato@empresa.com",
                    "phone": "+55 11 99999-9999",
                    "industry": "HEALTHCORE",
                    "segment": "LABORATORY",
                    "status": "ACTIVE",
                    "isBaseCompany": false
                  }
                },
                "example2": {
                  "summary": "Company with minimal data",
                  "value": {
                    "tradingName": "Minimal Company",
                    "legalName": "Minimal Company LTDA",
                    "taxId": "12345678901",
                    "email": "minimal@company.com",
                    "industry": "TECHNOLOGY",
                    "segment": "HOSPITAL"
                  }
                },
                "example3": {
                  "summary": "Company with tax ID formatting",
                  "value": {
                    "tradingName": "Formatted Company",
                    "legalName": "Formatted Company LTDA",
                    "taxId": "12.345.678/0001-99",
                    "email": "formatted@company.com",
                    "phone": "(11) 99999-9999",
                    "industry": "AGRIBUSINESS",
                    "segment": "ANIMAL_HEALTH",
                    "taxCountry": "br"
                  }
                }
              }
            }
          }
        },
        "responses": { "201": { "description": "" } },
        "summary": "Create a new company",
        "tags": ["Company"]
      }
    },
    "/companies/companies/{id}": {
      "put": {
        "description": "\nUpdates an existing company with automatic data transformation and validation.\n\n**Data Transformations:**\n- Trading name and legal name: automatic trim\n- Tax ID: removes non-numeric characters\n- Email: converts to lowercase and trims\n- Phone: automatic trim\n- Tax country: converts to uppercase\n    ",
        "operationId": "CompanyAdminController_updateCompany",
        "parameters": [
          {
            "name": "id",
            "required": true,
            "in": "path",
            "description": "Company ID",
            "schema": { "example": "123", "type": "string" }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CreateCompanyGatewayDto"
              },
              "examples": {
                "example1": {
                  "summary": "Update company data",
                  "value": {
                    "tradingName": "Empresa XPTO Atualizada",
                    "legalName": "Empresa XPTO Atualizada LTDA",
                    "taxId": "12345678000199",
                    "email": "novo@empresa.com",
                    "phone": "+55 11 98888-8888",
                    "industry": "TECHNOLOGY",
                    "segment": "HOSPITAL",
                    "status": "ACTIVE",
                    "isBaseCompany": false
                  }
                }
              }
            }
          }
        },
        "responses": { "200": { "description": "" } },
        "summary": "Update company",
        "tags": ["Company"]
      }
    },
    "/companies/companies/modules": {
      "get": {
        "description": "\nLists all available modules that can be enabled for companies.\n    ",
        "operationId": "CompanyAdminController_listModules",
        "parameters": [],
        "responses": {
          "200": {
            "description": "List of available modules",
            "content": {
              "application/json": {
                "schema": {
                  "example": [
                    {
                      "id": "00000000000000000000000000000000",
                      "code": "HR",
                      "name": "Human Resources",
                      "description": "Human resources management module",
                      "isActive": true,
                      "createdAt": "2025-06-23T23:32:29.601Z",
                      "updatedAt": "2025-06-23T23:32:29.601Z"
                    }
                  ]
                }
              }
            }
          }
        },
        "summary": "List available modules",
        "tags": ["Company"]
      }
    },
    "/companies/companies/{companyId}/modules": {
      "get": {
        "description": "\nLists all modules enabled for a specific company.\n    ",
        "operationId": "CompanyAdminController_listCompanyModules",
        "parameters": [
          {
            "name": "companyId",
            "required": true,
            "in": "path",
            "description": "Company ID",
            "schema": { "example": "123", "type": "string" }
          }
        ],
        "responses": {
          "200": {
            "description": "List of company modules",
            "content": {
              "application/json": {
                "schema": {
                  "example": [
                    {
                      "id": "00000000000000000000000000000000",
                      "companyId": "00000000000000000000000000000000",
                      "moduleId": "00000000000000000000000000000000",
                      "isActive": true,
                      "createdAt": "2025-06-23T23:32:29.601Z",
                      "updatedAt": "2025-06-23T23:32:29.601Z",
                      "module": {
                        "id": "00000000000000000000000000000000",
                        "code": "HR",
                        "name": "Human Resources",
                        "description": "Human resources management module",
                        "isActive": true
                      }
                    }
                  ]
                }
              }
            }
          }
        },
        "summary": "List company modules",
        "tags": ["Company"]
      },
      "post": {
        "description": "\nEnables a specific module for a company.\n\n**Required fields:**\n- moduleCode: The module code to enable\n- segment: The segment for the module\n    ",
        "operationId": "CompanyAdminController_enableModule",
        "parameters": [
          {
            "name": "companyId",
            "required": true,
            "in": "path",
            "description": "Company ID",
            "schema": { "example": "123", "type": "string" }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/EnableCompanyModuleDto"
              },
              "examples": {
                "example1": {
                  "summary": "Enable HR module",
                  "value": { "moduleCode": "HR", "segment": "HOSPITAL" }
                },
                "example2": {
                  "summary": "Enable Finance module",
                  "value": { "moduleCode": "FINANCE", "segment": "LABORATORY" }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Module enabled successfully",
            "content": {
              "application/json": {
                "schema": {
                  "example": {
                    "id": "00000000000000000000000000000000",
                    "companyId": "00000000000000000000000000000000",
                    "moduleId": "00000000000000000000000000000000",
                    "isActive": true,
                    "createdAt": "2025-06-23T23:32:29.601Z",
                    "updatedAt": "2025-06-23T23:32:29.601Z",
                    "module": {
                      "id": "00000000000000000000000000000000",
                      "code": "HR",
                      "name": "Human Resources",
                      "description": "Human resources management module",
                      "isActive": true
                    }
                  }
                }
              }
            }
          }
        },
        "summary": "Enable module for company",
        "tags": ["Company"]
      }
    }
  },
  "info": {
    "title": "Qualityflow - Administration Management API",
    "description": "\n# Qualityflow - Administration Management API\n\n## ⚠️ Restricted Access\n\n**ATTENTION**: All endpoints in this documentation require **GLOBAL_ADMIN** permission.\n\n## Authentication\n\n- **JWT Token**: Required in all endpoints\n- **Role**: GLOBAL_ADMIN\n- **Local Development**: Use `SKIP_AUTH=true` in .env to bypass authentication\n\n## Available Endpoints\n\n### Authentication\n- **POST** `/auth/login` - User login\n- **GET** `/auth/profile` - Authenticated user profile\n\n### Company Management\n- **GET** `/companies/filter` - Filter companies\n- **POST** `/company` - Create new company\n- **PUT** `/companies/:id` - Update company\n- **GET** `/companies/modules` - List available modules\n- **GET** `/companies/:companyId/modules` - List modules for company\n- **POST** `/companies/:companyId/modules` - Activate module for company\n\n## Available Filters\n\nAll filter endpoints support dynamic operators:\n- `eq:` (equals)\n- `in:` (in list)\n- `contains:` (contains text)\n- `gte:` (greater than or equal)\n- `lte:` (less than or equal)\n\nExample: `GET /companies/filter?status=eq:ACTIVE&or.tradingName=contains:Tech`\n    ",
    "version": "1.0",
    "contact": {}
  },
  "tags": [
    { "name": "Auth", "description": "Authentication and authorization" },
    {
      "name": "Company",
      "description": "Administrative management of companies"
    }
  ],
  "servers": [],
  "components": {
    "securitySchemes": {
      "JWT-auth": {
        "scheme": "bearer",
        "bearerFormat": "JWT",
        "type": "http",
        "name": "JWT",
        "description": "Enter JWT token with GLOBAL_ADMIN role",
        "in": "header"
      }
    },
    "schemas": {
      "CredentialDto": {
        "type": "object",
        "properties": {
          "email": { "type": "string", "description": "User email" },
          "password": { "type": "string", "description": "User password" }
        },
        "required": ["email", "password"]
      },
      "CreateCompanyGatewayDto": {
        "type": "object",
        "properties": {
          "tradingName": {
            "type": "string",
            "example": "Empresa XPTO",
            "description": "Trading name of the company"
          },
          "legalName": {
            "type": "string",
            "example": "Empresa XPTO LTDA",
            "description": "Legal name of the company"
          },
          "taxId": {
            "type": "string",
            "example": "12345678000199",
            "description": "Company tax ID"
          },
          "taxCountry": {
            "type": "string",
            "example": "BR",
            "description": "Country code for taxId"
          },
          "email": {
            "type": "string",
            "example": "contato@empresa.com",
            "description": "Company email"
          },
          "phone": {
            "type": "string",
            "example": "+55 11 99999-9999",
            "description": "Company phone"
          },
          "industry": {
            "type": "string",
            "enum": [
              "HEALTHCORE",
              "AGRIBUSINESS",
              "TRANSPORTATION_MOBILITY",
              "TECHNOLOGY"
            ],
            "example": "HEALTHCORE",
            "description": "Industry of the company"
          },
          "segment": {
            "type": "string",
            "enum": [
              "LABORATORY",
              "HOSPITAL",
              "MEDICAL_METALLURGY",
              "ANIMAL_HEALTH",
              "VEHICLE_INSPECTION",
              "VEHICLE_REGISTRATION",
              "DRIVING_SCHOOL"
            ],
            "example": "LABORATORY",
            "description": "Segment of the company within the industry"
          },
          "status": {
            "type": "string",
            "example": "ACTIVE",
            "description": "Company status",
            "enum": ["ACTIVE", "INACTIVE", "SUSPENDED"]
          },
          "addressId": {
            "type": "string",
            "example": "123e4567-e89b-12d3-a456-426614174000",
            "description": "Address ID"
          },
          "isBaseCompany": {
            "type": "boolean",
            "example": false,
            "description": "if company is base company"
          }
        },
        "required": [
          "tradingName",
          "legalName",
          "taxId",
          "email",
          "industry",
          "segment"
        ]
      },
      "EnableCompanyModuleDto": {
        "type": "object",
        "properties": {
          "moduleCode": {
            "type": "string",
            "example": "FINANCIAL",
            "description": "Module code to enable"
          },
          "segment": {
            "type": "string",
            "enum": [
              "LABORATORY",
              "HOSPITAL",
              "MEDICAL_METALLURGY",
              "ANIMAL_HEALTH",
              "VEHICLE_INSPECTION",
              "VEHICLE_REGISTRATION",
              "DRIVING_SCHOOL"
            ],
            "example": "LABORATORY",
            "description": "Segment for the module"
          }
        },
        "required": ["moduleCode", "segment"]
      }
    }
  }
}
